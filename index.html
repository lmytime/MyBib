<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Import style -->
    <link rel="stylesheet" href="//unpkg.com/element-plus/dist/index.css" />
    <!-- Import Vue 3 -->
    <script src="//unpkg.com/vue@next"></script>
    <!-- Import component library -->
    <script src="//unpkg.com/element-plus"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <style>
        html,
        body,
        #app,
        .container,
        .el-textarea {
            height: 100%;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
            align-items: center;
        }

        .button {
            text-align: center;
        }

        button {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .left,
        .right {
            font-family: Hack, 'Courier New', Courier, monospace;
            width: 45%;
            height: 95%;
        }

        textarea {
            white-space: pre;
            overflow-y: scroll;
            overflow-x: scroll;
            height: 100%;
        }

        .el-notification {
            height: 100px;
        }

        .el-dialog__title {
            font-size: xx-large;
        }

        .el-dialog__body {
            text-align: center;
            font-family:'Times New Roman', Times, serif;
            font-size: large;
            white-space: normal;
            word-break: keep-all;
        }
    </style>
    <title>MyBib</title>
</head>

<body>
    <div id="app">
        <el-dialog v-model="usage" title="Welcome to MyBib!" width="90%" center :show-close="false" :fullscreen="true">
            <div>
                <h2>Hello</h2>
                This webpage is designed to optimize citekeys of bibtex file. <br>
                The citekey of bibtex file generated by <a href="https://ui.adsabs.harvard.edu/">NASA/ADS</a> is its bibcode. <br>
                But I think maybe "Author+Year" is better, at least for myself. <br>
                For example, the citekey of the paper "Zur Elektrodynamik bewegter KÃ¶rper" is "1905AnP...322..891E". <br>
                And I prefer to use "Einstein1905" or "Einstein:1905". <br>
                This pushed me to build this webpage. <br>
                And please give me a <a href="https://github.com/lmytime/MyBib">star</a> if you think this webpage is helpful. <br><br>
                <h2>Usage</h2>
                <ol>
                    <li>
                        <p>
                            <b> Paste your bibtex file into the left textarea. You can get the bibtex file from <a href="https://ui.adsabs.harvard.edu/">NASA/ADS</a>.</b>
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Click the button "Go!" to optimize the citekey.</b>
                        </p>
                    </li>
                    <li>
                        <p>
                            <b>Copy the optimized bibtex file by clicking the "Copy" button.</b>
                        </p>
                    </li>
            </div>
            <template #footer>
                <span class="dialog-footer">
                    <el-button type="primary" @click="usage = false">Confirm</el-button>
                </span>
            </template>
        </el-dialog>
        <div class="container">
            <div class="left">
                <el-input id="input" v-model="input" type="textarea" placeholder="Input" resize="none">
                </el-input>
            </div>
            <div class="button">
                <el-button @click="usage=true">Usage</el-button><br>
                <el-button type="success" @click="run">Go!</el-button><br>
                <el-button @click="copy">Copy</el-button>
            </div>
            <div class="right">
                <el-input v-on:focus="$event.target.select()" ref="myoutput" id="output" v-model="output" readonly
                    type="textarea" placeholder="Output" resize="none">
                </el-input>
            </div>
        </div>
    </div>

    <script>
        const app = Vue.createApp({
            data() {
                return {
                    input: "",
                    output: "",
                    usage: true
                }
            },
            methods: {
                run() {
                    axios.post('/adsbib', {
                        input: this.input
                    }).then(res => {
                        this.output = res.data
                        console.log(res.data)
                    }).catch(err => {
                        ElementPlus.ElNotification({
                            title: 'Warning',
                            message: 'Input is not valid',
                            type: 'warning',
                        })
                    })
                },
                copy() {
                    this.$refs.myoutput.focus();
                    setTimeout(function () {
                        document.execCommand('copy');
                        ElementPlus.ElNotification({
                            title: 'Info',
                            message: 'Copy success',
                            type: 'info',
                        })
                    }, 100);
                }
            }
        })
        app.use(ElementPlus)
        app.mount('#app')

        let inputBox = document.getElementById('input');
        let outputBox = document.getElementById('output');

        function select_scroll_1(e) {
            outputBox.scrollTop = inputBox.scrollTop;
            outputBox.scrollLeft = inputBox.scrollLeft;
        }

        function select_scroll_2(e) {
            inputBox.scrollTop = outputBox.scrollTop;
            inputBox.scrollLeft = outputBox.scrollLeft;
        }

        inputBox.addEventListener('scroll', select_scroll_1, false);
        outputBox.addEventListener('scroll', select_scroll_2, false);
    </script>
</body>

</html>
